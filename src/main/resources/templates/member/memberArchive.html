<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="/rs/css/myarchive.css">
    <script type="text/javascript"src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="/rs/js/auto_table.js"></script>
    <script src="/rs/js/gulim.js"></script>
    <script th:inline="javascript">
        
      function topdf(data) {

    	var name = data;  
    	  
        var doc = new jspdf.jsPDF("p", "mm", "a4");

        doc.addFileToVFS("malgun.ttf", _fonts); //_fonts 변수는 Base64 형태로 변환된 내용입니다.
        doc.addFont("malgun.ttf", "malgun", "normal");
        doc.setFont("malgun");

        doc.line(15, 25, 195, 25); // 선그리기(시작x, 시작y, 종료x, 종료y)
        doc.text(15, 20, "진료 내역 확인서 ");
        doc.text(15, 35, "환자명 : "+name);
        
        doc.text(20, 220, "위 환자는 상기 기록된 기간동안 본 병원에 내원하였음을 확인합니다."); // 글씨입력(시작x, 시작y, 내용)

        var info = new Image();
        info.src = "/rs/images/SOONYANG.png";

        var sign = new Image();
        sign.src = "/rs/images/soonyang_signature.png";

        
        let day = ['일', '월', '화', '수', '목', '금', '토'];
        let today = new Date();
        let dateFormat1 = today.getFullYear() + '년 ' + (today.getMonth()+1) + '월 '
        	+ today.getDate() + '일 ';
        
        doc.text(100, 270, dateFormat1 + "순양병원 대표 김연수");
        
        
        info.onload = function () {
          doc.addImage(info, "PNG", 25, 120, 160, 90);
          doc.addImage(sign, "PNG", 180, 260, 20, 20);
		
          doc.autoTable({
            startX: 30,
            startY: 40,
            styles : { font : 'malgun', fontStyle :'normal'},
            html: "#testtable",
          });

          doc.save("내원이력.pdf"); //결과 출력
        };
      };
    </script>
</head>
<body>
	<section layout:fragment="content">
		<div class="table-wrap shadow-4">
			<table id="testtable" class="table">
				<thead class="thead-bg">
				<tr>
					<th>No.</th>
					<th>방문일</th>
					<th>진료과</th>
				</tr>
				</thead>
				<tbody class="tbody-bg">
						<tr th:unless ="${#lists.isEmpty(memberArchiveDate)}" th:each="arch : ${memberArchive}">
							<td class="tbody-td tbody-no">[[${archStat.size - archStat.count+1}]]</td>
							<td class="tbody-td tbody-date">[[${#strings.substring(arch.key,0,16)}]]</td>
							<td class="tbody-td tbody-med" >[[${arch.value}]]</td>
						</tr>
						
						<tr th:if ="${#lists.isEmpty(memberArchiveDate)}">
							<td colspan="3" class="no_archive"><p>진료 기록이 없습니다.</p></td>
						</tr>
				</tbody>
			</table>
		</div>
			 <button type="button" th:onclick="topdf([[${membername}]])"> pdf로 출력 </button>
	</section>
	
	
</body>
</html>