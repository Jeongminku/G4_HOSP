<!DOCTYPE html>

<!-- layout이 적용되어있는 페이지 폼 입니다. 
		따로 적용할 거 없이 "content 영역에 각 페이지 별 내용 기입하시면 됩니다."-->

<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8" />
<title>환자 진료 내역 페이지입니다.</title>

<!-- THYMELEAF JS  -->
<th:block layout:fragment="script">
	<script th:inline="javascript">
    
	$(document).ready(function(){
    	var errorMessage = [[${errorMessage}]];
    	if(errorMessage != null){
        	alert(errorMessage);
    	}
	});
	
	function readURL(input) {
 		var id = $(input).attr('id');
	    var reader = new FileReader();
	    reader.onload = function(e) {
	      document.getElementById('preview'+id).src = e.target.result;
	    };
	    reader.readAsDataURL(input.files[0]);
    }
    
	function deletearchive(value){
		var confir = confirm("진료내역을 삭제하시겠습니까?");
		if(confir){
			alert("삭제가 완료되었습니다.");
			location.href = "/archive/delete/"+value;
		}else{
			alert("삭제를 취소합니다.");
			return false;
		}
	}
	

	function discharge(value){
		var confir = confirm("퇴원처리 하시겠습니까?");
		if(confir){
			alert("퇴원처리가 완료되었습니다.");
			location.href = "/hospitalize/delete/"+value;
		}else{
			alert("퇴원을 취소합니다.");
			return false;
		}
	}
	
	
	</script>
</th:block>

<!-- THYMELEAF CSS -->
<th:block layout:fragment="css">
	<style>
.wrap {
	width: 70%;
	margin: 0 auto;
}

.headwrap{
	margin: 0 auto;
}

.viewhead{
	text-align: center;
	border-bottom: 3px solid; 
	margin-bottom: 10px;
	height: 15%;
	}
	
.viewlineboxup {
}

.viewlinebox {
	text-align: center;
	height: 30px;
	margin-top: 10px;
	border-bottom: 3px solid;
}

.linemenu{
	height: 35px;
	text-align: center;
	display: table;
	margin-top: 10px;
}
.tablemenu{
	border: 1px solid
}
.detailbody {
	border: none;
}

.cont_img{
	width: 15%;
}

a:hover {
	cursor: pointer;
}

.condivide{
	border-right: 3px solid;
	
}

.cond{
	margin-left: 5px;
}

.but{
	height: 30px;
	width: 80px;
}

</style>
</th:block>
</head>
<body>
	<div layout:fragment="content">
		<div class="wrap">
			<div class="cont">
				<!-- USER INFO, POST INFO  -->
				<div class="row head" style="margin: 0 auto; margin-bottom: 150px">
					<div class="col-md-10 headwrap">
					
					<div class="col-md-12 viewhead">
						<h1> [[${patientinfo.name}]]님 진료 내역</h1>
					</div>
					<div class="col-md-12 viewlinebox">
						<div class="boxcont">
						<span> 환자명 :  </span> 
						<span class="condivide"> [[${patientinfo.name}]] </span> 
						<span class="cond"> 나이 : </span> 
						<span class="condivide"> [[${age}]] </span>
						<span class="cond"> 입원여부 : </span> 
						<span> [[${hospYN}]] </span>						
						</div>
					</div>
					<div class="col-md-12 linemenu">
						<div>
						<a th:href="'/archive/write/'+${patientinfo.id}"> 신규작성 </a>
						<a th:if ="${hospYN} == N" th:href="'/hospitalize/'+${patientinfo.id}"> 입원수속 </a>
						<a th:if ="${hospYN} == Y" th:href="'/hospitalize/view/'+${patientinfo.id}"> 입원정보확인 </a>
						<a th:if ="${hospYN} == Y" th:onclick = "discharge([[${patientinfo.id}]])"> 퇴원수속 </a>						
						</div>
					</div>
					<div class="col-md-12 viewlineboxup"></div>
					<div class="col-md-12 tablemenu" th:each="archive : ${ArchiveList}">
						<table class="table table-bordered">
							<tbody>
								<tr>
									<th scope="row">진료내역번호</th>
									<td>[[${archive.id}]]</td>
									<th scope="row">진료일</th>
									<td>[[${archive.ArchiveCreatedtime}]]</td>
								</tr>
								<tr>
									<!--질병명?  -->
								</tr>
								<tr>
									<th scope="row">담당의</th>
									<td>[[${archive.doctorname}]]</td>
									<th th:if = "archive.ArchiveModifiedtime != null" scope="row">차트 수정일</th>
									<td th:if = "archive.ArchiveModifiedtime != null" >[[${archive.ArchiveModifiedtime}]]</td>
								</tr>
								<tr class="detailhead">
									<td colspan="4">
										<div>세부 진료 사항</div>
										<p> [[${archive.detail}]] </p>
										<span th:each="AI : ${ArchiveImgList}">
											<span th:each = "IMGLIST : ${AI}">
	 												<span th:if="${IMGLIST.getArchive().getId()} == ${archive.id}">
													<img th:alt="${IMGLIST.imgname}" th:src="${IMGLIST.imgurl}" style="width: 20%">
												</span>
											</span>
										</span>									
									</td>	
								</tr>
							</tbody>
						</table>
					<div class="col-md-12 linemenu">
						<a th:href="'/archive/update/'+${archive.id}"> 진료내역수정 </a>
						<a th:onclick="deletearchive([[${archive.id}]])" > 진료내역삭제 </a>
					</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>



</body>
</html>
