<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
	<meta charset="UTF-8" />
	<title>순양병원</title>
	<!-- THYMELEAF JS  -->
	<script th:inline="javascript">
		$(document).ready(function(){
			var errorMessage = [[${errorMessage}]];
			if(errorMessage != null){
				alert(errorMessage);
			}
		});
		
		function readURL(input) {
			var id = $(input).attr('id');
			var reader = new FileReader();
			reader.onload = function(e) {
			document.getElementById('preview'+id).src = e.target.result;
			};
			reader.readAsDataURL(input.files[0]);
		}
		
		function deletearchive(value){
			var confir = confirm("진료내역을 삭제하시겠습니까?");
			if(confir){
				alert("삭제가 완료되었습니다.");
				location.href = "/archive/delete/"+value;
			}else{
				alert("삭제를 취소합니다.");
				return false;
			}
		}

		function discharge(value){
			var confir = confirm("퇴원처리 하시겠습니까?");
			if(confir){
				alert("퇴원처리가 완료되었습니다.");
				location.href = "/hospitalize/delete/"+value;
			}else{
				alert("퇴원을 취소합니다.");
				return false;
			}
		}
	</script>

	<!-- THYMELEAF CSS -->
	<style th:inline="text">
		section{
		}

		.wrap {
			margin: 0 auto;
		}

		.headwrap{
			margin: 0 auto;
		}

		.viewhead{
			text-align: center;
			border-bottom: 3px solid; 
			margin-bottom: 10px;
			height: 80px;
		}

		.viewlinebox {
			text-align: center;
			height: 30px;
			margin-top: 10px;
			border-bottom: 3px solid;
		}

		.linemenu{
			height: 35px;
			text-align: center;
			display: table;
			margin-top: 15px;
		}
		.tablemenu{
			border: 1px solid;
			background-color: white;
		}

		.detailbody {
			border: none;
		}

		.cont_img{
			width: 15%;
		}

		a:hover {
			cursor: pointer;
		}

		.condivide{
			border-right: 3px solid;
		}

		.cond{
			margin-left: 5px;
		}

		.but{
			height: 30px;
			width: 80px;
			background: #226597;
			color: white;
		}

		.table{
			margin-top: 20px;
			width: 90%;
			margin-left: auto;
			margin-right: auto;
		}

		tr{
			border-bottom: 1px solid;
		}

		.inhead{
			font-weight: bold;
			margin-top: 20px;
		}

		.inbody{
			margin-bottom: 15px;
			padding: 5px;
		}

		.imgbody{
			padding: 5px;
		}

	</style>
</head>
<body>
	<section layout:fragment="content">
		<div class="wrap">
			<div class="cont">
				<!-- USER INFO, POST INFO  -->
				<div class="row head" style="margin: 0 auto; margin-bottom: 150px">
					<div class="col-md-10 headwrap">
						<div class="col-md-12 viewhead">
							<span style="color: #226597; font-size: 2.5rem; font-weight: bold;">[[${patientinfo.name}]]</span><span style="font-size: 2.5rem; font-weight: bold;">님 진료 내역</span>
						</div>
						<div class="col-md-12 viewlinebox">
							<div class="boxcont">
								<span> 환자명 :  </span> 
								<span class="condivide"> [[${patientinfo.name}]] </span> 
								<span class="cond"> 나이 : </span> 
								<span class="condivide"> [[${age}]] </span>
								<span class="cond"> 입원여부 : </span> 
								<span> [[${hospYN}]] </span>						
							</div>
						</div>
						<div class="col-md-12 linemenu">
							<div>
								<a th:href="'/archive/write/'+${patientinfo.id}" sec:authorize="hasAnyAuthority('ROLE_DOCTOR')"> 신규작성 </a>
								<a th:if ="${hospYN} == N" th:href="'/hospitalize/'+${patientinfo.id}" sec:authorize="hasAnyAuthority('ROLE_DOCTOR')"> 입원수속 </a>
								<a th:if ="${hospYN} == Y" th:href="'/hospitalize/view/'+${patientinfo.id}" sec:authorize="hasAnyAuthority('ROLE_DOCTOR')"> 입원정보확인 </a>
								<a th:if ="${hospYN} == Y" th:onclick = "discharge([[${patientinfo.id}]])" sec:authorize="hasAnyAuthority('ROLE_DOCTOR')"> 퇴원수속 </a>						
							</div>
						</div>
						<div class="col-md-12 viewlineboxup"></div>
						<div class="col-md-12 tablemenu" th:each="archive : ${AVDlist}">
						<table class="table table-bordered">
							<tbody>
								<tr>
									<th scope="row">진료내역번호</th>
									<td>[[${archive.ARid}]]</td>
									<th scope="row">진료목적 (병명)</th>
									<td>[[${archive.ARdiseasename}]]</td>
		
								</tr>
								<tr>
									<th scope="row">담당의</th>
									<td>[[${archive.ARdoctorname}]]</td>
									<th scope="row">진료일</th>
									<td>[[${archive.ARcreatedtime}]]</td>
								</tr>
								<tr>
									<th th:if = "archive.ARmodifiedtime != null" scope="row">차트 수정일</th>
									<td th:if = "archive.ARmodifiedtime != null" >[[${archive.ARmodifiedtime}]]</td>
								</tr>
								<tr class="detailhead">
									<td colspan="4">
										<div class="inhead first">세부 진료 사항</div>
										<div class="inbody"> [[${archive.ARdetail}]] </div>
										<div class="inhead"> 이미지 첨부 </div>
										<div class="imgbody">
											<span th:each="AI : ${ArchiveImgList}">
												<span th:each = "IMGLIST : ${AI}">
													<span th:if="${IMGLIST.getArchive().getId()} == ${archive.ARid}">
														<img th:alt="${IMGLIST.imgname}" th:src="${IMGLIST.imgurl}" style="width: 20%">
													</span>
												</span>
											</span>																			
										</div> 
									</td>	
								</tr>
							</tbody>
						</table>
					<div class="col-md-12 linemenu">
						<a th:href="'/archive/update/'+${archive.ARid}" style="font-weight: bold; color: #226597;"> 진료내역수정 </a>
						<a th:onclick="deletearchive([[${archive.ARid}]])" style="font-weight: bold; color: #226597;"> 진료내역삭제 </a>
					</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</body>
</html>
